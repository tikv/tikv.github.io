<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `jemalloc_ctl` crate."><meta name="keywords" content="rust, rustlang, rust-lang, jemalloc_ctl"><title>jemalloc_ctl - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="../favicon.ico"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../jemalloc_ctl/index.html'><div class='logo-container'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate jemalloc_ctl</p><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all jemalloc_ctl's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'jemalloc_ctl', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/jemalloc_ctl/lib.rs.html#1-506' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>jemalloc_ctl</a></span></h1><div class='docblock'><p>jemalloc control and introspection.</p>
<p>jemalloc offers a powerful introspection and control interface through the <code>mallctl</code> function.
It can be used to tune the allocator, take heap dumps, and retrieve statistics. This crate
provides a typed API over that interface.</p>
<p>While <code>mallctl</code> takes a string to specify an operation (e.g. <code>stats.allocated</code> or
<code>stats.arenas.15.muzzy_decay_ms</code>), the overhead of repeatedly parsing those strings is not
ideal. Fortunately, jemalloc offers the ability to translate the string ahead of time into a
&quot;Management Information Base&quot; (MIB) to speed up future lookups.</p>
<p>This crate provides both a function and a type for each <code>mallctl</code> operation. While the
function is more convenient, the type will be more efficient if the operation will be repeatedly
performed. Its constructor performs the MIB lookup, so the struct should be saved if the same
operation is going to be repeatedly performed.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<p>Repeatedly printing allocation statistics:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">jemallocator</span>;
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">jemalloc_ctl</span>;

<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">time</span>::<span class="ident">Duration</span>;

<span class="attribute">#[<span class="ident">global_allocator</span>]</span>
<span class="kw">static</span> <span class="ident">ALLOC</span>: <span class="ident">jemallocator</span>::<span class="ident">Jemalloc</span> <span class="op">=</span> <span class="ident">jemallocator</span>::<span class="ident">Jemalloc</span>;

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="kw">loop</span> {
        <span class="comment">// many statistics are cached and only updated when the epoch is advanced.</span>
        <span class="ident">jemalloc_ctl</span>::<span class="ident">epoch</span>().<span class="ident">unwrap</span>();

        <span class="kw">let</span> <span class="ident">allocated</span> <span class="op">=</span> <span class="ident">jemalloc_ctl</span>::<span class="ident">stats</span>::<span class="ident">allocated</span>().<span class="ident">unwrap</span>();
        <span class="kw">let</span> <span class="ident">resident</span> <span class="op">=</span> <span class="ident">jemalloc_ctl</span>::<span class="ident">stats</span>::<span class="ident">resident</span>().<span class="ident">unwrap</span>();
        <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{} bytes allocated/{} bytes resident&quot;</span>, <span class="ident">allocated</span>, <span class="ident">resident</span>);
        <span class="ident">thread</span>::<span class="ident">sleep</span>(<span class="ident">Duration</span>::<span class="ident">from_secs</span>(<span class="number">10</span>));
    }
}</pre></div>
<p>Doing the same with the MIB-based API:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">jemallocator</span>;
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">jemalloc_ctl</span>;

<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">time</span>::<span class="ident">Duration</span>;

<span class="attribute">#[<span class="ident">global_allocator</span>]</span>
<span class="kw">static</span> <span class="ident">ALLOC</span>: <span class="ident">jemallocator</span>::<span class="ident">Jemalloc</span> <span class="op">=</span> <span class="ident">jemallocator</span>::<span class="ident">Jemalloc</span>;

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="kw">let</span> <span class="ident">epoch</span> <span class="op">=</span> <span class="ident">jemalloc_ctl</span>::<span class="ident">Epoch</span>::<span class="ident">new</span>().<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">allocated</span> <span class="op">=</span> <span class="ident">jemalloc_ctl</span>::<span class="ident">stats</span>::<span class="ident">Allocated</span>::<span class="ident">new</span>().<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">resident</span> <span class="op">=</span> <span class="ident">jemalloc_ctl</span>::<span class="ident">stats</span>::<span class="ident">Resident</span>::<span class="ident">new</span>().<span class="ident">unwrap</span>();
    <span class="kw">loop</span> {
        <span class="comment">// many statistics are cached and only updated when the epoch is advanced.</span>
        <span class="ident">epoch</span>.<span class="ident">advance</span>().<span class="ident">unwrap</span>();

        <span class="kw">let</span> <span class="ident">allocated</span> <span class="op">=</span> <span class="ident">allocated</span>.<span class="ident">get</span>().<span class="ident">unwrap</span>();
        <span class="kw">let</span> <span class="ident">resident</span> <span class="op">=</span> <span class="ident">resident</span>.<span class="ident">get</span>().<span class="ident">unwrap</span>();
        <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{} bytes allocated/{} bytes resident&quot;</span>, <span class="ident">allocated</span>, <span class="ident">resident</span>);
        <span class="ident">thread</span>::<span class="ident">sleep</span>(<span class="ident">Duration</span>::<span class="ident">from_secs</span>(<span class="number">10</span>));
    }
}</pre></div>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="arenas/index.html" title='jemalloc_ctl::arenas mod'>arenas</a></td><td class='docblock-short'><p>Arena operations.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="config/index.html" title='jemalloc_ctl::config mod'>config</a></td><td class='docblock-short'><p>Information about the jemalloc compile-time configuration</p>
</td></tr><tr class='module-item'><td><a class="mod" href="opt/index.html" title='jemalloc_ctl::opt mod'>opt</a></td><td class='docblock-short'><p>Information about the run-time jemalloc configuration.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="stats/index.html" title='jemalloc_ctl::stats mod'>stats</a></td><td class='docblock-short'><p>Global allocator statistics.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="stats_print/index.html" title='jemalloc_ctl::stats_print mod'>stats_print</a></td><td class='docblock-short'><p>Bulk statistics output.</p>
</td></tr><tr class='module-item'><td><a class="mod" href="thread/index.html" title='jemalloc_ctl::thread mod'>thread</a></td><td class='docblock-short'><p>Thread specific operations.</p>
</td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.BackgroundThread.html" title='jemalloc_ctl::BackgroundThread struct'>BackgroundThread</a></td><td class='docblock-short'><p>A type providing access to the state of internal background worker threads.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Epoch.html" title='jemalloc_ctl::Epoch struct'>Epoch</a></td><td class='docblock-short'><p>A type providing access to the jemalloc epoch.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.MaxBackgroundThreads.html" title='jemalloc_ctl::MaxBackgroundThreads struct'>MaxBackgroundThreads</a></td><td class='docblock-short'><p>A type providing access to the maximum number of background threads that will be created.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Version.html" title='jemalloc_ctl::Version struct'>Version</a></td><td class='docblock-short'><p>A type providing access to the jemalloc version string.</p>
</td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.background_thread.html" title='jemalloc_ctl::background_thread fn'>background_thread</a></td><td class='docblock-short'><p>Returns the state of internal background worker threads.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.epoch.html" title='jemalloc_ctl::epoch fn'>epoch</a></td><td class='docblock-short'><p>Advances the jemalloc epoch, returning it.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.max_background_threads.html" title='jemalloc_ctl::max_background_threads fn'>max_background_threads</a></td><td class='docblock-short'><p>Returns the maximum number of background threads that will be created.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.set_background_thread.html" title='jemalloc_ctl::set_background_thread fn'>set_background_thread</a></td><td class='docblock-short'><p>Enables or disables internal background worker threads.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.set_max_background_threads.html" title='jemalloc_ctl::set_max_background_threads fn'>set_max_background_threads</a></td><td class='docblock-short'><p>Sets the maximum number of background threads that will be created.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.version.html" title='jemalloc_ctl::version fn'>version</a></td><td class='docblock-short'><p>Returns the jemalloc version string.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../";window.currentCrate = "jemalloc_ctl";</script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>